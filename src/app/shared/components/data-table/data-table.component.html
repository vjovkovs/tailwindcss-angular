<div class="data-table-container">
  <!-- Header with search and new button -->
  <div class="mb-4 flex items-center justify-between gap-4">
    <!-- Search -->
    <div class="flex-1" *ngIf="config().searchable">
      <div class="relative">
        <input
          type="text"
          [placeholder]="config().searchPlaceholder || 'Search...'"
          [value]="searchTerm()"
          (input)="onSearchChange($any($event.target).value)"
          class="w-full rounded-lg border border-gray-300 bg-white px-4 py-2 pl-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
        />
        <svg
          class="absolute left-3 top-2.5 h-5 w-5 text-gray-400"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>
    </div>

    <!-- New button -->
    <div *ngIf="config().onNew">
      <button
        type="button"
        (click)="onNewClick()"
        class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4v16m8-8H4"
          />
        </svg>
        {{ config().newButtonLabel || 'New' }}
      </button>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-hidden rounded-lg border border-gray-200 bg-white shadow">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200" [class]="config().tableClass">
        <!-- Table Header -->
        <thead class="bg-gray-50">
          <tr>
            <!-- Selection checkbox -->
            <th
              *ngIf="config().selectable"
              scope="col"
              class="w-12 px-6 py-3"
            >
              <input
                *ngIf="config().multiSelect"
                type="checkbox"
                [checked]="selectedRows().length === paginatedData().length && paginatedData().length > 0"
                (change)="toggleAllRows()"
                class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
              />
            </th>

            <!-- Row numbers -->
            <th
              *ngIf="config().showRowNumbers"
              scope="col"
              class="w-16 px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500"
            >
              #
            </th>

            <!-- Column headers -->
            <th
              *ngFor="let column of visibleColumns()"
              scope="col"
              [class]="column.headerClass || 'px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500'"
              [style.width]="column.width"
            >
              <div class="flex items-center gap-2">
                <span>{{ column.label }}</span>
                <!-- Sort indicator -->
                <button
                  *ngIf="column.sortable"
                  type="button"
                  (click)="toggleSort(column)"
                  class="focus:outline-none"
                >
                  <svg
                    *ngIf="getSortDirection(column) === 'asc'"
                    class="h-4 w-4 text-gray-700"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
                  </svg>
                  <svg
                    *ngIf="getSortDirection(column) === 'desc'"
                    class="h-4 w-4 text-gray-700"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h5a1 1 0 000-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
                  </svg>
                  <svg
                    *ngIf="!getSortDirection(column)"
                    class="h-4 w-4 text-gray-400"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path d="M5 12a1 1 0 102 0V6.414l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L5 6.414V12zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
                  </svg>
                </button>
              </div>
            </th>

            <!-- Actions column -->
            <th
              *ngIf="hasActions()"
              scope="col"
              class="relative px-6 py-3"
            >
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>

        <!-- Table Body -->
        <tbody class="divide-y divide-gray-200 bg-white">
          <!-- Loading state -->
          <tr *ngIf="loading()">
            <td [attr.colspan]="visibleColumns().length + (config().selectable ? 1 : 0) + (config().showRowNumbers ? 1 : 0) + (hasActions() ? 1 : 0)" class="px-6 py-8 text-center">
              <div class="flex items-center justify-center gap-2 text-gray-500">
                <svg class="h-5 w-5 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>{{ config().loadingMessage || 'Loading...' }}</span>
              </div>
            </td>
          </tr>

          <!-- Empty state -->
          <tr *ngIf="!loading() && paginatedData().length === 0">
            <td [attr.colspan]="visibleColumns().length + (config().selectable ? 1 : 0) + (config().showRowNumbers ? 1 : 0) + (hasActions() ? 1 : 0)" class="px-6 py-8 text-center text-gray-500">
              {{ config().emptyStateMessage || 'No data available' }}
            </td>
          </tr>

          <!-- Data rows -->
          <tr
            *ngFor="let row of paginatedData(); let i = index"
            (click)="onRowClick(row)"
            [class.bg-blue-50]="isRowSelected(row)"
            [class.cursor-pointer]="config().onRowClick"
            class="hover:bg-gray-50"
          >
            <!-- Selection checkbox -->
            <td *ngIf="config().selectable" class="px-6 py-4">
              <input
                type="checkbox"
                [checked]="isRowSelected(row)"
                (change)="toggleRowSelection(row)"
                (click)="$event.stopPropagation()"
                class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
              />
            </td>

            <!-- Row number -->
            <td *ngIf="config().showRowNumbers" class="px-6 py-4 text-sm text-gray-500">
              {{ showingFrom() + i }}
            </td>

            <!-- Data cells -->
            <td
              *ngFor="let column of visibleColumns()"
              [class]="column.columnClass || 'px-6 py-4 text-sm text-gray-900'"
            >
              <ng-container *ngIf="column.cellTemplate; else defaultCell">
                <ng-container *ngTemplateOutlet="column.cellTemplate; context: { $implicit: row, column: column }"></ng-container>
              </ng-container>
              <ng-template #defaultCell>
                {{ getCellValue(row, column) }}
              </ng-template>
            </td>

            <!-- Actions -->
            <td *ngIf="hasActions()" class="px-6 py-4 text-right text-sm font-medium">
              <div class="flex items-center justify-end gap-2">
                <button
                  *ngFor="let action of config().actions"
                  type="button"
                  [hidden]="!isActionVisible(action, row)"
                  [disabled]="isActionDisabled(action, row)"
                  (click)="onActionClick(action, row, $event)"
                  [class]="action.buttonClass || 'text-blue-600 hover:text-blue-900 disabled:text-gray-400 disabled:cursor-not-allowed'"
                  [title]="action.label"
                >
                  <span *ngIf="action.icon" [innerHTML]="action.icon"></span>
                  <span *ngIf="!action.icon">{{ action.label }}</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="config().pageable && paginatedData().length > 0" class="border-t border-gray-200 bg-white px-4 py-3 sm:px-6">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <!-- Results info -->
        <div class="text-sm text-gray-700">
          Showing
          <span class="font-medium">{{ showingFrom() }}</span>
          to
          <span class="font-medium">{{ showingTo() }}</span>
          of
          <span class="font-medium">{{ totalCount() }}</span>
          results
        </div>

        <!-- Pagination controls -->
        <div class="flex items-center gap-4">
          <!-- Page size selector -->
          <div class="flex items-center gap-2">
            <label for="pageSize" class="text-sm text-gray-700">Per page:</label>
            <select
              id="pageSize"
              [value]="pageSize()"
              (change)="onPageSizeChange(+$any($event.target).value)"
              class="rounded-md border-gray-300 py-1 pl-3 pr-8 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"
            >
              <option *ngFor="let size of pageSizeOptions()" [value]="size">
                {{ size }}
              </option>
            </select>
          </div>

          <!-- Page navigation -->
          <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
            <!-- Previous button -->
            <button
              type="button"
              (click)="previousPage()"
              [disabled]="currentPage() === 1"
              class="relative inline-flex items-center rounded-l-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50"
            >
              <span class="sr-only">Previous</span>
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>

            <!-- Page numbers -->
            <button
              *ngFor="let page of getPageNumbers()"
              type="button"
              (click)="goToPage(page)"
              [class.bg-blue-50]="page === currentPage()"
              [class.text-blue-600]="page === currentPage()"
              [class.z-10]="page === currentPage()"
              [class.border-blue-500]="page === currentPage()"
              class="relative inline-flex items-center border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
            >
              {{ page }}
            </button>

            <!-- Next button -->
            <button
              type="button"
              (click)="nextPage()"
              [disabled]="currentPage() === totalPages()"
              class="relative inline-flex items-center rounded-r-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-50"
            >
              <span class="sr-only">Next</span>
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="space-y-6">
  <!-- Navigation -->
  <div class="flex gap-2 pb-4 border-b border-gray-200">
    <a
      routerLink="/"
      routerLinkActive="bg-primary-100 text-primary-700"
      [routerLinkActiveOptions]="{ exact: true }"
      class="text-sm px-3 py-1.5 rounded-md font-medium text-gray-600 hover:bg-gray-100 transition-colors duration-200"
    >
      Phase 1: Basic Forms
    </a>
    <a
      routerLink="/phase2"
      routerLinkActive="bg-primary-100 text-primary-700"
      class="text-sm px-3 py-1.5 rounded-md font-medium text-gray-600 hover:bg-gray-100 transition-colors duration-200"
    >
      Phase 2: Advanced Forms
    </a>
    <a
      routerLink="/phase3"
      routerLinkActive="bg-primary-100 text-primary-700"
      class="text-sm px-3 py-1.5 rounded-md font-medium text-gray-600 hover:bg-gray-100 transition-colors duration-200"
    >
      Phase 3: Layouts & Steps
    </a>
  </div>

  <!-- Header -->
  <div class="flex justify-between items-center">
    <div>
      <h2 class="text-2xl font-bold text-gray-900">Users</h2>
      <p class="mt-1 text-sm text-gray-600">
        Example feature demonstrating TanStack Query with optimistic updates, Mutations, Typed Forms, and Zod validation
      </p>
      <div class="mt-2 flex items-center gap-2">
        <span class="text-xs text-gray-500">Form Mode:</span>
        <button
          (click)="toggleFormMode()"
          class="text-xs px-3 py-1 rounded-full border transition-colors"
          [class.bg-primary-100]="!useDynamicForm()"
          [class.text-primary-700]="!useDynamicForm()"
          [class.border-primary-300]="!useDynamicForm()"
          [class.bg-gray-100]="useDynamicForm()"
          [class.text-gray-600]="useDynamicForm()"
          [class.border-gray-300]="useDynamicForm()"
        >
          Manual
        </button>
        <button
          (click)="toggleFormMode()"
          class="text-xs px-3 py-1 rounded-full border transition-colors"
          [class.bg-primary-100]="useDynamicForm()"
          [class.text-primary-700]="useDynamicForm()"
          [class.border-primary-300]="useDynamicForm()"
          [class.bg-gray-100]="!useDynamicForm()"
          [class.text-gray-600]="!useDynamicForm()"
          [class.border-gray-300]="!useDynamicForm()"
        >
          Dynamic
        </button>
      </div>
    </div>
    <button
      (click)="openAddDialog()"
      class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
    >
      Add User
    </button>
  </div>

  <!-- Loading State -->
  @if (usersQuery.isLoading()) {
    <div class="bg-white shadow-md rounded-lg overflow-hidden p-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
      <p class="mt-2 text-sm text-gray-600">Loading users...</p>
    </div>
  }

  <!-- Users Table -->
  @if (!usersQuery.isLoading()) {
    <div class="bg-white shadow-md rounded-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Name
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Email
            </th>
            <th
              scope="col"
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Role
            </th>
            <th scope="col" class="relative px-6 py-3">
              <span class="sr-only">Actions</span>
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @if (usersQuery.data()?.length === 0) {
            <tr>
              <td colspan="4" class="px-6 py-8 text-center text-sm text-gray-500">
                No users found. Click "Add User" to create one.
              </td>
            </tr>
          }
          @for (user of usersQuery.data(); track user.id) {
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                {{ user.name }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ user.email }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                  {{ user.role }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <button
                  (click)="openEditDialog(user)"
                  class="text-primary-600 hover:text-primary-900 transition-colors"
                >
                  Edit
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- User Dialog (Add/Edit) -->
  <app-dialog [(open)]="dialogOpen" [closeOnBackdrop]="!isSaving">
    <div class="p-6">
      <h2 dialog-title class="text-xl font-semibold text-gray-900 mb-4">
        {{ isEditMode() ? 'Edit User' : 'Add New User' }}
        <span class="text-sm font-normal text-gray-500 ml-2">
          ({{ useDynamicForm() ? 'Dynamic' : 'Manual' }} Form)
        </span>
      </h2>

      <!-- Dynamic Form -->
      @if (useDynamicForm()) {
        <app-dynamic-form
          [config]="dynamicFormConfig"
          [initialData]="dynamicFormInitialData"
          [loading]="isSaving"
          (formSubmit)="onDynamicFormSubmit($event)"
          (formCancel)="closeDialog()"
        />
      }

      <!-- Manual Form -->
      @if (!useDynamicForm()) {
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <!-- Name Field -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">
            Name
          </label>
          <input
            type="text"
            id="name"
            formControlName="name"
            [disabled]="isSaving"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border disabled:bg-gray-100 disabled:cursor-not-allowed"
            [class.border-error]="getFieldError('name')"
          />
          @if (getFieldError('name')) {
            <p class="mt-1 text-sm text-error">{{ getFieldError('name') }}</p>
          }
        </div>

        <!-- Email Field -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">
            Email
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            [disabled]="isSaving"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border disabled:bg-gray-100 disabled:cursor-not-allowed"
            [class.border-error]="getFieldError('email')"
          />
          @if (getFieldError('email')) {
            <p class="mt-1 text-sm text-error">{{ getFieldError('email') }}</p>
          }
        </div>

        <!-- Role Field -->
        <div>
          <label for="role" class="block text-sm font-medium text-gray-700">
            Role
          </label>
          <select
            id="role"
            formControlName="role"
            [disabled]="isSaving"
            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 border disabled:bg-gray-100 disabled:cursor-not-allowed"
            [class.border-error]="getFieldError('role')"
          >
            <option value="">Select a role</option>
            <option value="Admin">Admin</option>
            <option value="User">User</option>
            <option value="Guest">Guest</option>
          </select>
          @if (getFieldError('role')) {
            <p class="mt-1 text-sm text-error">{{ getFieldError('role') }}</p>
          }
        </div>

        <!-- Actions -->
        <div dialog-actions class="flex gap-3 justify-end mt-6 pt-4 border-t">
          <button
            type="button"
            (click)="closeDialog()"
            [disabled]="isSaving"
            class="inline-flex justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Cancel
          </button>
          <button
            type="submit"
            [disabled]="!userForm.valid || isSaving"
            class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (isSaving) {
              <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Saving...
            } @else {
              {{ isEditMode() ? 'Update User' : 'Add User' }}
            }
          </button>
        </div>
      </form>
      }
    </div>
  </app-dialog>
</div>
